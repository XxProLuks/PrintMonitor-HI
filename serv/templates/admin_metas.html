{% extends "base.html" %}
{% block title %}Admin - Metas{% endblock %}

{% block content %}
<div class="page-header">
  <h2><i class="bi bi-bullseye"></i> Administração de Metas</h2>
</div>

{% if message %}
<div class="alert alert-info alert-dismissible fade show" role="alert">
  <i class="bi bi-info-circle"></i> {{ message }}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<div class="card mb-4">
  <div class="card-header bg-transparent border-0">
    <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Criar Nova Meta</h5>
  </div>
  <div class="card-body">
    <form method="post" class="row g-3">
      <input type="hidden" name="action" value="create">
      <div class="col-md-3">
        <label class="form-label">Tipo</label>
        <select name="tipo" class="form-select" required>
          <option value="user">Usuário</option>
          <option value="setor">Setor</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Referência</label>
        <input type="text" name="referencia" class="form-control" placeholder="Nome do usuário ou setor" required>
      </div>
      <div class="col-md-2">
        <label class="form-label">Período</label>
        <select name="periodo" class="form-select">
          <option value="mensal">Mensal</option>
          <option value="trimestral">Trimestral</option>
          <option value="anual">Anual</option>
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">Meta Páginas</label>
        <input type="number" name="meta_paginas" class="form-control" placeholder="Páginas">
      </div>
      <div class="col-md-2">
        <label class="form-label">Meta Custo (R$)</label>
        <input type="number" step="0.01" name="meta_custo" class="form-control" placeholder="0.00">
      </div>
      <div class="col-md-2">
        <label class="form-label">Ano</label>
        <input type="number" name="ano" class="form-control" value="{{ ano_atual }}">
      </div>
      <div class="col-md-2">
        <label class="form-label">Mês (se mensal)</label>
        <input type="number" name="mes" class="form-control" min="1" max="12" placeholder="1-12">
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary btn-modern">
          <i class="bi bi-save"></i> Criar Meta
        </button>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-header bg-transparent border-0">
    <h5 class="mb-0"><i class="bi bi-list-ul"></i> Metas Configuradas</h5>
  </div>
  <div class="card-body">
    {% if metas %}
    <div class="table-responsive">
      <table class="table table-modern">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Referência</th>
            <th>Período</th>
            <th>Meta Páginas</th>
            <th>Meta Custo</th>
            <th>Ano</th>
            <th>Mês</th>
          </tr>
        </thead>
        <tbody>
          {% for meta in metas %}
          <tr>
            <td>
              {% if meta.tipo == 'user' %}
              <span class="badge bg-primary badge-modern">Usuário</span>
              {% else %}
              <span class="badge bg-info badge-modern">Setor</span>
              {% endif %}
            </td>
            <td><strong>{{ meta.referencia }}</strong></td>
            <td>{{ meta.periodo }}</td>
            <td>{{ meta.meta_paginas or '-' }}</td>
            <td>{% if meta.meta_custo %}R$ {{ "%.2f"|format(meta.meta_custo) }}{% else %}-{% endif %}</td>
            <td>{{ meta.ano }}</td>
            <td>{{ meta.mes or '-' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="alert alert-info">
      <i class="bi bi-info-circle"></i> Nenhuma meta configurada.
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

