{% extends "base.html" %}
{% block title %}Gamificação e Ranking - Print Monitor{% endblock %}

{% block content %}
<div class="page-header">
  <h2><i class="bi bi-trophy"></i> Gamificação e Ranking</h2>
  <p class="text-muted">Acompanhe seu desempenho e compare com outros usuários</p>
</div>

<!-- Pontuação do Usuário -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card stat-card">
      <div class="card-body text-center">
        <div class="stat-icon-large" style="background: var(--accent-yellow);">
          <i class="bi bi-star-fill"></i>
        </div>
        <h3 class="mt-3">{{ "{:,}".format(pontos_usuario.pontos) }}</h3>
        <p class="text-muted mb-0">Pontos</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card">
      <div class="card-body text-center">
        <div class="stat-icon-large" style="background: var(--accent-blue);">
          <i class="bi bi-arrow-up-circle"></i>
        </div>
        <h3 class="mt-3">Nível {{ pontos_usuario.nivel }}</h3>
        <p class="text-muted mb-0">Nível Atual</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card">
      <div class="card-body text-center">
        <div class="stat-icon-large" style="background: var(--accent-green);">
          <i class="bi bi-cash-coin"></i>
        </div>
        <h3 class="mt-3">R$ {{ "%.2f"|format(pontos_usuario.economia) }}</h3>
        <p class="text-muted mb-0">Economia Total</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card">
      <div class="card-body text-center">
        <div class="stat-icon-large" style="background: var(--accent-purple);">
          <i class="bi bi-award"></i>
        </div>
        <h3 class="mt-3">{{ pontos_usuario.badges|length }}</h3>
        <p class="text-muted mb-0">Badges</p>
      </div>
    </div>
  </div>
</div>

<!-- Badges -->
{% if pontos_usuario.badges %}
<div class="card mb-4">
  <div class="card-header bg-transparent border-0">
    <h5 class="mb-0"><i class="bi bi-award"></i> Minhas Conquistas</h5>
  </div>
  <div class="card-body">
    <div class="d-flex gap-3 flex-wrap">
      {% for badge in pontos_usuario.badges %}
      <div class="badge-item">
        <i class="bi bi-trophy-fill" style="font-size: 2rem; color: var(--accent-yellow);"></i>
        <small class="d-block mt-1">{{ badge|title }}</small>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}

<!-- Ranking de Usuários -->
<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0"><i class="bi bi-people"></i> Ranking de Usuários</h5>
      </div>
      <div class="card-body">
        {% if ranking_usuarios %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Posição</th>
                <th>Usuário</th>
                <th>Pontos</th>
                <th>Nível</th>
              </tr>
            </thead>
            <tbody>
              {% for item in ranking_usuarios %}
              <tr>
                <td>
                  {% if item.posicao == 1 %}
                    <i class="bi bi-trophy-fill text-warning"></i> 1º
                  {% elif item.posicao == 2 %}
                    <i class="bi bi-trophy-fill text-secondary"></i> 2º
                  {% elif item.posicao == 3 %}
                    <i class="bi bi-trophy-fill" style="color: #cd7f32;"></i> 3º
                  {% else %}
                    {{ item.posicao }}º
                  {% endif %}
                </td>
                <td><strong>{{ item.usuario }}</strong></td>
                <td>{{ "{:,}".format(item.pontos) }}</td>
                <td><span class="badge bg-info">Nível {{ item.nivel }}</span></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted text-center py-3">Nenhum ranking disponível ainda.</p>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="col-md-6">
    <div class="card">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0"><i class="bi bi-building"></i> Ranking de Setores</h5>
      </div>
      <div class="card-body">
        {% if ranking_setores %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Posição</th>
                <th>Setor</th>
                <th>Pontos</th>
                <th>Economia</th>
              </tr>
            </thead>
            <tbody>
              {% for item in ranking_setores %}
              <tr>
                <td>
                  {% if item.posicao == 1 %}
                    <i class="bi bi-trophy-fill text-warning"></i> 1º
                  {% elif item.posicao == 2 %}
                    <i class="bi bi-trophy-fill text-secondary"></i> 2º
                  {% elif item.posicao == 3 %}
                    <i class="bi bi-trophy-fill" style="color: #cd7f32;"></i> 3º
                  {% else %}
                    {{ item.posicao }}º
                  {% endif %}
                </td>
                <td><strong>{{ item.setor }}</strong></td>
                <td>{{ "{:,}".format(item.pontos) }}</td>
                <td>R$ {{ "%.2f"|format(item.economia) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted text-center py-3">Nenhum ranking disponível ainda.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
.stat-icon-large {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  color: white;
  margin: 0 auto;
}

.badge-item {
  text-align: center;
  padding: 15px;
  background: var(--bg-tertiary);
  border-radius: 10px;
  min-width: 100px;
}
</style>
{% endblock %}

